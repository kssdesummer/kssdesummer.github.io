I"º‘<h1 id="nodejs">Nodejs</h1>

<h3 id="nodejs-å’Œ-npm-çš„å®‰è£…">Node.js å’Œ npm çš„å®‰è£…</h3>

<ol>
  <li>node.jsä¸‹è½½åœ°å€ï¼šhttps://nodejs.org/en/</li>
  <li>åœ¨æ–‡ä»¶å¤¹ç›´æ¥è§£å‹æˆ–è€…ç”¨<code class="highlighter-rouge">tar -zxvf å‹ç¼©åŒ…</code></li>
  <li>åœ¨è§£å‹æ–‡ä»¶é‡Œæ‰¾åˆ°nodeå’Œnpmä½ç½®ï¼š<code class="highlighter-rouge">bin</code>ç›®å½•ä¸‹é¢</li>
  <li>å°†nodeå’Œnpmé“¾æ¥åˆ°å…¨å±€ç¬¦å·ï¼š
    <ol>
      <li><code class="highlighter-rouge">sudo ln -s å…¨è·¯å¾„/node /usr/bin/node</code></li>
      <li><code class="highlighter-rouge">sudo ln -s å…¨è·¯å¾„/npm /usr/bin/npm</code></li>
    </ol>
  </li>
  <li>åœ¨ä»»æ„ç›®å½•ä¸‹ä½¿ç”¨<code class="highlighter-rouge">node -v</code>æˆ–è€…<code class="highlighter-rouge">npm -v</code> å°±å¯ä»¥çœ‹åˆ°ç›¸å…³ç‰ˆæœ¬å·</li>
  <li>å®‰è£…å®Œæˆ</li>
</ol>

<h3 id="nodeç¨‹åº">nodeç¨‹åº</h3>

<p>â€‹	1. åœ¨jsæ–‡æ¡£çš„ç¬¬ä¸€è¡Œæ€»æ˜¯å†™ä¸Š<code class="highlighter-rouge">use strict</code>; è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªjsä»£ç </p>

<ol>
  <li>åœ¨jsæ–‡ä»¶ä¸­æƒ³è¦æŸ¥çœ‹çš„ç»“æœç”¨<code class="highlighter-rouge">console.log("hello world")</code></li>
  <li><code class="highlighter-rouge">node --use strict hello.js</code>ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼</li>
</ol>

<h3 id="æ­å»ºnodeå¼€å‘ç¯å¢ƒ">æ­å»ºNodeå¼€å‘ç¯å¢ƒ</h3>

<p>â€‹	æ¨èä½¿ç”¨ visual studio code</p>

<h3 id="æ¨¡å—">æ¨¡å—</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">hello</span><span class="p">.</span><span class="nx">js</span>
<span class="kd">function</span> <span class="nx">greet</span><span class="p">(){</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">1</span><span class="dl">"</span><span class="p">);</span><span class="c1">//åœ¨ç»ˆç«¯æ§åˆ¶å°æ˜¾ç¤ºè¾“å‡º</span>
	<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">greet</span><span class="p">;</span>	<span class="c1">//å°†greetå‡½æ•°å£°æ˜å‡ºå»ï¼Œåˆ«çš„æ¨¡å—ä¹Ÿå¯ä»¥ä½¿ç”¨</span>

<span class="nx">main</span><span class="p">.</span><span class="nx">js</span>
<span class="kd">var</span> <span class="nx">greet</span> <span class="o">=</span><span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./hello</span><span class="dl">'</span><span class="p">);</span>	<span class="c1">//ä½¿ç”¨æ—¶åªéœ€è¦å†æ¬¡å£°æ˜ï¼Œå¹¶ä¸”è¦åŠ ä¸Šè¯¥æ¨¡å—çš„è·¯å¾„å’Œåå­—</span>
</code></pre></div></div>

<h3 id="commonjsè§„èŒƒ">CommonJSè§„èŒƒ</h3>

<p>â€‹	å®šä¹‰å°±æ˜¯å„ä¸ªæ¨¡å—é—´çš„å˜é‡äº’ä¸å½±å“ï¼Œæƒ³è¦ä½¿ç”¨åˆ«çš„æ¨¡å—çš„å˜é‡ï¼Œå°±éœ€è¦ç”¨moudule.exportå’Œrequireæ¥ä¼ è¾“å’Œæ¥å—</p>

<h3 id="fsæ¨¡å—">fsæ¨¡å—</h3>

<p>â€‹	fsï¼šæ˜¯Node.jsçš„æ¨¡å—ï¼Œè´Ÿè´£è¯»å†™æ–‡ä»¶(åŒæ­¥æˆ–å¼‚æ­¥)</p>

<ol>
  <li>
    <p>è¯»æ–‡ä»¶</p>

    <ol>
      <li>
        <p>å¼‚æ­¥ï¼š</p>

        <p><code class="highlighter-rouge">fs.readFile('111.txt','utf-8',function(err,data){});</code></p>
      </li>
      <li>
        <p>åŒæ­¥ï¼š</p>

        <p><code class="highlighter-rouge">var data = fs.readFileSync('sample.txt', 'utf-8');</code></p>
      </li>
    </ol>
  </li>
  <li>
    <p>å†™æ–‡ä»¶</p>
  </li>
  <li>
    <p>å¼‚æ­¥ï¼š</p>

    <p><code class="highlighter-rouge">fs.writeFile('output.txt',data,function(err){});</code></p>
  </li>
  <li>
    <p>åŒæ­¥ï¼š</p>

    <p><code class="highlighter-rouge">fs.writeFileSync('output.txt', data);</code></p>
  </li>
  <li>
    <p>æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯</p>

    <ol>
      <li><code class="highlighter-rouge">fs.stat('output.txt',function(err,stat){});</code></li>
    </ol>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>
   
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
   
<span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="dl">'</span><span class="s1">sample.txt</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// æ˜¯å¦æ˜¯æ–‡ä»¶:</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">isFile: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isFile</span><span class="p">());</span>
        <span class="c1">// æ˜¯å¦æ˜¯ç›®å½•:</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">isDirectory: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stat</span><span class="p">.</span><span class="nx">isFile</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// æ–‡ä»¶å¤§å°:</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">size: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
            <span class="c1">// åˆ›å»ºæ—¶é—´, Dateå¯¹è±¡:</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">birth time: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">birthtime</span><span class="p">);</span>
            <span class="c1">// ä¿®æ”¹æ—¶é—´, Dateå¯¹è±¡:</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">modified time: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">mtime</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="err">è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</span>
   
<span class="na">isFile</span><span class="p">:</span> <span class="kc">true</span>
<span class="na">isDirectory</span><span class="p">:</span> <span class="kc">false</span>
<span class="na">size</span><span class="p">:</span> <span class="mi">181</span>
<span class="nx">birth</span> <span class="na">time</span><span class="p">:</span> <span class="nx">Fri</span> <span class="nx">Dec</span> <span class="mi">11</span> <span class="mi">2015</span> <span class="mi">09</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">41</span> <span class="nx">GMT</span><span class="o">+</span><span class="mi">0800</span> <span class="p">(</span><span class="nx">CST</span><span class="p">)</span>
<span class="nx">modified</span> <span class="na">time</span><span class="p">:</span> <span class="nx">Fri</span> <span class="nx">Dec</span> <span class="mi">11</span> <span class="mi">2015</span> <span class="mi">12</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span> <span class="nx">GMT</span><span class="o">+</span><span class="mi">0800</span> <span class="p">(</span><span class="nx">CST</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="stream-æ¨¡å—">stream æ¨¡å—</h3>

<p>â€‹	è¾“å…¥è¾“å‡ºæµ</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// fs.createReadStreamè¯»å– æ‰“å¼€ä¸€ä¸ªæµ:æ‰“å¼€æ ¼å¼è¦è®¾ç½®ï¼</span>
<span class="kd">var</span> <span class="nx">rs</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">'</span><span class="s1">example.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">//dataäº‹ä»¶è¡¨ç¤ºæµçš„æ•°æ®å·²ç»å¯ä»¥è¯»å–äº†</span>
<span class="nx">rs</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">DATA:</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// endäº‹ä»¶è¡¨ç¤ºè¿™ä¸ªæµå·²ç»åˆ°æœ«å°¾äº†ï¼Œæ²¡æœ‰æ•°æ®å¯ä»¥è¯»å–äº†</span>
<span class="nx">rs</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">END</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">//erroräº‹ä»¶è¡¨ç¤ºå‡ºé”™äº†ã€‚</span>
<span class="nx">rs</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// fs.createWriteStream å†™å…¥æµ</span>
<span class="kd">var</span> <span class="nx">ws1</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="dl">'</span><span class="s1">output1.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">ws1</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">ä½¿ç”¨Streamå†™å…¥æ–‡æœ¬æ•°æ®...</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">ws1</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">END.</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">ws1</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>

<span class="c1">// var ws2 = fs.createWriteStream('output1.txt');</span>
<span class="c1">// ws2.write(new Buffer('ä½¿ç”¨Streamå†™å…¥äºŒè¿›åˆ¶æ•°æ®...\n', 'utf-8'));</span>
<span class="c1">// ws2.write(new Buffer('END.', 'utf-8'));</span>
<span class="c1">// ws2.end();</span>

<span class="c1">// pipeï¼šç®¡é“ï¼Œå¯ä»¥å°†å†™å…¥æµä¸è¯»å–æµè¿æ¥</span>
<span class="kd">var</span> <span class="nx">rs</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">'</span><span class="s1">example.txt</span><span class="dl">'</span><span class="p">);</span><span class="c1">//è¯»å–</span>
<span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="dl">'</span><span class="s1">copied.txt</span><span class="dl">'</span><span class="p">);</span><span class="c1">//å†™å…¥</span>
<span class="nx">rs</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">ws</span><span class="p">);</span><span class="c1">//å°†è¯»å–çš„å†…å®¹å†™å…¥copied.txt</span>
<span class="c1">// rs.pipe(ws,{end:false}); endäº‹ä»¶è§¦å‘åä¸å…³é—­</span>
<span class="cm">/*é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Readableæµçš„æ•°æ®è¯»å–å®Œæ¯•ï¼Œendäº‹ä»¶è§¦å‘åï¼Œå°†è‡ªåŠ¨å…³é—­Writableæµã€‚å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›è‡ªåŠ¨å…³é—­Writableæµï¼Œéœ€è¦ä¼ å…¥å‚æ•°ï¼š
readable.pipe(writable, { end: false });
 */</span>
</code></pre></div></div>

<h3 id="httpæ¨¡å—">httpæ¨¡å—</h3>

<p>â€‹	åˆ©ç”¨Node.jsæ¨¡å—å¯ä»¥ç›´æ¥ä½¿ç”¨tcpè¿æ¥ä»¥åŠè§£æHTTPï¼Œè€Œæˆ‘ä»¬åªéœ€è¦å»æ“ä½œhttpæ¨¡å—æä¾›çš„requestå’Œresponseå¯¹è±¡ã€‚</p>

<p>â€‹	requestå¯¹è±¡ï¼šå°è£…äº†httpè¯·æ±‚ï¼Œè°ƒç”¨resquestå±æ€§å’Œæ–¹æ³•å¯ä»¥æ‹¿åˆ°httpè¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯</p>

<p>â€‹	responseå¯¹è±¡ï¼šå°è£…äº†httpå“åº”ï¼Œè°ƒç”¨responseå¯¹è±¡çš„æ–¹æ³•ï¼Œå°±èƒ½æŠŠhttpçš„å“åº”è¿”å›ç»™æµè§ˆå™¨</p>

<ul>
  <li>æ­å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼š</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// å¯¼å…¥httpæ¨¡å—:</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// åˆ›å»ºhttp serverï¼Œå¹¶ä¼ å…¥å›è°ƒå‡½æ•°:</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// å›è°ƒå‡½æ•°æ¥æ”¶requestå’Œresponseå¯¹è±¡,</span>
    <span class="c1">// è·å¾—HTTPè¯·æ±‚çš„methodå’Œurl:</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">method</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="c1">// å°†HTTPå“åº”200å†™å…¥response, åŒæ—¶è®¾ç½®htmlç±»å‹å’Œutf8ç¼–ç æ ¼å¼ Content-Type: text/html;charset=utf8ï¼Œ:'use strict';</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="dl">'</span><span class="s1">sample.txt</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// æ˜¯å¦æ˜¯æ–‡ä»¶:</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">isFile: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isFile</span><span class="p">());</span>
        <span class="c1">// æ˜¯å¦æ˜¯ç›®å½•:</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">isDirectory: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stat</span><span class="p">.</span><span class="nx">isFile</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// æ–‡ä»¶å¤§å°:</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">size: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">size</span><span class="p">);</span>
            <span class="c1">// åˆ›å»ºæ—¶é—´, Dateå¯¹è±¡:</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">birth time: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">birthtime</span><span class="p">);</span>
            <span class="c1">// ä¿®æ”¹æ—¶é—´, Dateå¯¹è±¡:</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">modified time: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">mtime</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
<span class="err">è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</span>

<span class="na">isFile</span><span class="p">:</span> <span class="kc">true</span>
<span class="na">isDirectory</span><span class="p">:</span> <span class="kc">false</span>
<span class="na">size</span><span class="p">:</span> <span class="mi">181</span>
<span class="nx">birth</span> <span class="na">time</span><span class="p">:</span> <span class="nx">Fri</span> <span class="nx">Dec</span> <span class="mi">11</span> <span class="mi">2015</span> <span class="mi">09</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">41</span> <span class="nx">GMT</span><span class="o">+</span><span class="mi">0800</span> <span class="p">(</span><span class="nx">CST</span><span class="p">)</span>
<span class="nx">modified</span> <span class="na">time</span><span class="p">:</span> <span class="nx">Fri</span> <span class="nx">Dec</span> <span class="mi">11</span> <span class="mi">2015</span> <span class="mi">12</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">00</span> <span class="nx">GMT</span><span class="o">+</span><span class="mi">0800</span> <span class="p">(</span><span class="nx">CST</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html;charset=utf8</span><span class="dl">'</span><span class="p">});</span>
    <span class="c1">// å°†HTTPå“åº”çš„HTMLå†…å®¹å†™å…¥response:</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;input name="user"&gt;&lt;br/&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;input name="password"&gt;&lt;br/&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;input type="submit"&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;h1&gt;Hello world!&lt;/h1&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="c1">//end å’Œ write éƒ½å¯ä»¥ä¸å†™ï¼Œä½†æ˜¯response.end()å¿…é¡»è¦æœ‰</span>
<span class="p">});</span>

<span class="c1">// è®©æœåŠ¡å™¨ç›‘å¬8080ç«¯å£:</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Server is running at http://127.0.0.1:8080/</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="urlæ¨¡å—">urlæ¨¡å—</h3>

<p>â€‹	ç”¨æ¥è§£æurlå¯¹è±¡ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://user:pass@host.com:8080/path/to/file?query=string#hash</span><span class="dl">'</span><span class="p">));</span>
<span class="err">ç»“æœå¦‚ä¸‹ï¼š</span>

<span class="nx">Url</span> <span class="p">{</span>
  <span class="nl">protocol</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http:</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">slashes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">auth</span><span class="p">:</span> <span class="dl">'</span><span class="s1">user:pass</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">host.com:8080</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">port</span><span class="p">:</span> <span class="dl">'</span><span class="s1">8080</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">hostname</span><span class="p">:</span> <span class="dl">'</span><span class="s1">host.com</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">hash</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#hash</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">search</span><span class="p">:</span> <span class="dl">'</span><span class="s1">?query=string</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">query</span><span class="p">:</span> <span class="dl">'</span><span class="s1">query=string</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">pathname</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/path/to/file</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/path/to/file?query=string</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">href</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://user:pass@host.com:8080/path/to/file?query=string#hash</span><span class="dl">'</span> <span class="p">}</span>
</code></pre></div></div>

<h3 id="pathæ¨¡å—ç›¸å…³">pathæ¨¡å—ç›¸å…³</h3>

<p>â€‹	ç”¨æ¥æ–¹ä¾¿çš„æ„é€ ç›®å½•</p>

<ul>
  <li>æ„é€ ç›®å½•</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// è§£æå½“å‰ç›®å½•:</span>
<span class="kd">var</span> <span class="nx">workDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// '/Users/michael'</span>

<span class="c1">// ç»„åˆå®Œæ•´çš„æ–‡ä»¶è·¯å¾„:å½“å‰ç›®å½•+'pub'+'index.html':</span>
<span class="kd">var</span> <span class="nx">filePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">workDir</span><span class="p">,</span> <span class="dl">'</span><span class="s1">pub</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">index.html</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">//å¾—åˆ°å®Œæ•´çš„è·¯å¾„ '/Users/michael/pub/index.html'</span>
</code></pre></div></div>

<ul>
  <li>æ­å»ºä¸€ä¸ªç®€å•çš„æ–‡ä»¶æœåŠ¡å™¨ï¼š
    <ul>
      <li>éœ€æ±‚åˆ†æï¼š
        <ol>
          <li>æœ¬æœºå¯ä»¥ç›´æ¥è®¿é—®ï¼šhttp://127.0.0.1:8080/</li>
          <li>èƒ½å¤Ÿè¯»å–æœ¬æœºçš„æ–‡æ¡£ï¼ˆhtml/txtï¼‰</li>
          <li>å¦‚æœæ˜¯ç›®å½•ï¼ŒæŸ¥æ‰¾è¯¥ç›®å½•ä¸‹æ˜¯å¦æœ‰index.htmlæ–‡æ¡£ï¼Œæœ‰åˆ™æ‰“å¼€ï¼Œæ— åˆ™è¿”å›404</li>
        </ol>
      </li>
    </ul>
  </li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//å¯¼å…¥fsæ¨¡å—ï¼šç”¨æ¥è¯»å–æ–‡æ¡£å†…å®¹ï¼Œpathï¼šæ„é€ ç›®å½•ï¼Œurlï¼šè§£æhttpç½‘å€ï¼Œhttpï¼šå¾—åˆ°è¯·æ±‚å’Œå“åº”</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// æ„é€ ç›®å½•ï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•ï¼Œå‡è®¾ä¸å†å½“å‰ç›®å½•ï¼Œåˆ™æ„é€ ä¸ºç»å¯¹è·¯å¾„</span>
<span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// æ‰“å°rootç›®å½•</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Root dir : </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">root</span><span class="p">);</span>
<span class="c1">// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œåˆ©ç”¨httpæ¨¡å—ï¼Œå¾—åˆ°è¯·æ±‚requestå’Œå“åº”response</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="nx">response</span><span class="p">){</span>
	<span class="c1">//è§£æè¯·æ±‚ç½‘å€ï¼Œå¾—åˆ°pathname</span>
    <span class="kd">var</span> <span class="nx">pathname</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>
    <span class="c1">// ç”¨pathæ¨¡å—æ‹¼æ¥è·¯å¾„ï¼Œå¾—åˆ°å®Œæ•´ç›®å½•</span>
    <span class="kd">var</span> <span class="nx">filePath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span><span class="nx">pathname</span><span class="p">);</span>
    <span class="c1">//console.log('filePath : '+filePath);</span>
    <span class="c1">// fsæ¨¡å—è·å–æ–‡ä»¶ä¿¡æ¯ï¼Œç”¨æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯ç›®å½•è¿˜æ˜¯æ–‡æ¡£</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">stats</span><span class="p">){</span>
    	<span class="c1">// å¦‚æœæ²¡é”™å¹¶ä¸”æ–‡ä»¶ä¿¡æ¯æ˜¯ä¸€ä¸ªæ–‡æ¡£</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">isFile</span><span class="p">()){</span>
        	<span class="c1">//æ‰“å°çŠ¶æ€200ï¼šè¯·æ±‚çš„åœ°å€</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">200 </span><span class="dl">'</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
            <span class="c1">//å“åº”å¤´200ï¼Œè®¾ç½®ç¼–ç æ ¼å¼ä¸ºutf8ï¼Œç±»å‹ä¸ºtext/html</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">text/html;charset=UTF8</span><span class="dl">'</span><span class="p">});</span>
            <span class="c1">// å°†è¯»åˆ°çš„å†…å®¹æµå‘response</span>
            <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">filePath</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
          <span class="c1">//æ¡ä»¶ï¼šä¸å‡ºé”™è€Œä¸”æ˜¯ä¸€ä¸ªç›®å½•ï¼Œæ‹¼æ¥ç›®å½•</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">()){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">filePath</span><span class="o">+</span><span class="dl">'</span><span class="s1"> isDir</span><span class="dl">'</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="dl">'</span><span class="s1">index.html</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">200 </span><span class="dl">'</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="o">+</span><span class="dl">'</span><span class="s1">/index.html</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span><span class="dl">'</span><span class="s1">text/html;charset=UTF8</span><span class="dl">'</span><span class="p">});</span>
            <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">html</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span><span class="p">{</span>  
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">404 </span><span class="dl">'</span><span class="o">+</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
            <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">404 Not Found</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
<span class="c1">// ç›‘å¬8080ç«¯å£</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
<span class="c1">// ä»£ç æ­£å¸¸è¿è¡Œç»™ä¸€ä¸ªæç¤º</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Server is running at http://127.0.0.1:8080/</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

:ET